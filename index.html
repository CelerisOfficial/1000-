<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>UNDCPT Chatbot</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #1e1e1e;
    color: #eee;
    margin: 0;
    display: flex;
    flex-direction: column;
    height: 100vh;
  }
  #chat {
    flex: 1;
    overflow-y: auto;
    padding: 20px;
    background: #2c2c2c;
    font-size: 18px;
    line-height: 1.4;
  }
  .message {
    margin-bottom: 15px;
    max-width: 70%;
    padding: 10px 15px;
    border-radius: 15px;
    word-wrap: break-word;
  }
  .user {
    background: #4a90e2;
    align-self: flex-end;
    color: #fff;
  }
  .bot {
    background: #444;
    align-self: flex-start;
  }
  #inputArea {
    display: flex;
    padding: 10px;
    background: #222;
  }
  #userInput {
    flex: 1;
    padding: 12px;
    font-size: 18px;
    border-radius: 25px;
    border: none;
    outline: none;
    background: #333;
    color: #eee;
  }
  #sendBtn {
    margin-left: 10px;
    background: #4a90e2;
    border: none;
    border-radius: 25px;
    color: white;
    font-size: 18px;
    padding: 12px 20px;
    cursor: pointer;
    transition: background 0.3s ease;
  }
  #sendBtn:hover {
    background: #357abd;
  }
</style>
</head>
<body>

<div id="chat"></div>

<div id="inputArea">
  <input type="text" id="userInput" placeholder="Mesajını yaz knk..." autocomplete="off" />
  <button id="sendBtn">Gönder</button>
</div>

<script>
const chat = document.getElementById('chat');
const userInput = document.getElementById('userInput');
const sendBtn = document.getElementById('sendBtn');

let lastUserMessage = "";

// Kısaltma ve eş anlamlılar sözlüğü
const slangDict = {
  "knk": "kanka",
  "kank": "kanka",
  "ii": "iyi",
  "iy": "iyi",
  "b.iyi": "bende iyi",
  "b.iyiyim": "bende iyiyim",
  "napiyon": "napıyorsun",
  "napıyon": "napıyorsun",
  "napıyosun": "napıyorsun",
  "naber": "nasılsın",
  "selam": "merhaba",
  "eyvallah": "teşekkürler",
  "eyv": "teşekkürler",
  "s.a": "selamun aleyküm",
  "sa": "selam",
  "slm": "selam"
};

// Cevap veritabanı
const responseDB = [
  {
    keywords: ["merhaba", "selam", "sa", "slm", "s.a"],
    answers: ["Selam knk, naber?", "Hey knk! Ne haber?", "Merhaba dostum!"]
  },
  {
    keywords: ["naber", "nasılsın", "napıyorsun", "napıyon"],
    answers: ["İyiyim knk, sen ne yapıyorsun?", "Gayet iyiyim, sen nasılsın?", "Süper knk, sen ne yapıyorsun?"]
  },
  {
    keywords: ["iyi", "iyiyim", "bende iyi", "b.iyi"],
    answers: ["İyi olmana sevindim knk!", "Harikasın dostum!", "Süpersin knk!"]
  },
  {
    keywords: ["teşekkürler", "eyv", "eyvallah"],
    answers: ["Rica ederim knk!", "Ne demek dostum!", "Her zaman buradayım!"]
  },
  {
    keywords: ["nasılsın", "iyiyim", "iyi"],
    answers: ["Ben hep iyiyim, sen nasılsın?", "İyiyim knk, sen ne yapıyorsun?", "Gayet iyiyim, sen napıyorsun?"]
  }
];

// Küfür listesi
const curseWords = ["amk", "siktir", "orospu", "piç", "ananı", "amına", "göt", "salak", "aptal"];

// Yazıyı normalize et (küçük harfe çevir, noktalama kaldır, kısaltmaları değiştir)
function normalizeText(input) {
  let txt = input.toLowerCase().replace(/[.,!?]/g, "").trim();
  let words = txt.split(/\s+/).map(w => slangDict[w] || w);
  return words.join(" ");
}

// Cevap bulma fonksiyonu
function findResponse(input) {
  let cleanedInput = normalizeText(input);
  const words = cleanedInput.split(/\s+/);

  // Küfür kontrolü
  for(let cword of curseWords) {
    if(words.includes(cword)) {
      return randomChoice([
        "Küfür yok knk, saygılı olalım :)",
        "Lütfen küfür etme, burası temiz yer!",
        "Küfürü kapatalım knk, daha güzel sohbet edelim."
      ]);
    }
  }

  // Konuşma bağlamı kontrolü
  if(lastUserMessage) {
    let lastNorm = normalizeText(lastUserMessage);

    if(/naber|nasılsın|napıyorsun/.test(lastNorm) && /iyi|bende iyi|iyiyim/.test(cleanedInput)) {
      return randomChoice([
        "Süper knk, devam!",
        "İyi olmana sevindim!",
        "Harikasın dostum!"
      ]);
    }

    if(/bende iyi|iyi|iyiyim/.test(lastNorm) && /sen napıyorsun|sen ne yapıyorsun|napıyorsun/.test(cleanedInput)) {
      return randomChoice([
        "Ben hep iyiyim, sen nasılsın?",
        "İyiyim knk, sen ne yapıyorsun?",
        "Gayet iyiyim, sen napıyorsun?"
      ]);
    }
  }

  // Genel cevaplar
  for(let entry of responseDB) {
    for(let kw of entry.keywords) {
      if(words.includes(kw)) {
        return randomChoice(entry.answers);
      }
    }
  }

  return "Bunu anlayamadım knk, başka bi şey dene :)";
}

// Rastgele cevap seç
function randomChoice(arr) {
  return arr[Math.floor(Math.random()*arr.length)];
}

// Mesaj ekle
function addMessage(text, sender) {
  const div = document.createElement('div');
  div.classList.add('message', sender);
  div.textContent = text;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}

// Gönder butonu ve enter ile gönderme
function handleSend() {
  let input = userInput.value.trim();
  if(input === "") return;
  addMessage(input, 'user');
  lastUserMessage = input;
  setTimeout(() => {
    let botReply = findResponse(input);
    addMessage(botReply, 'bot');
  }, 250);
  userInput.value = "";
}

sendBtn.addEventListener('click', handleSend);
userInput.addEventListener('keydown', e => {
  if(e.key === 'Enter') handleSend();
});
</script>

</body>
</html>
